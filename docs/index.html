<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to pyComBat’s documentation! &mdash; pyComBat 0.4.4 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/epigenelogo_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            pyComBat
              <img src="_static/epigenelogo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Welcome to pyComBat’s documentation!</a><ul>
<li><a class="reference internal" href="#general-overview">General Overview</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#license">License</a></li>
<li><a class="reference internal" href="#installing-pycombat">Installing pyComBat</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-pycombat">Using pyComBat</a><ul>
<li><a class="reference internal" href="#minimal-usage-example">Minimal usage example</a></li>
<li><a class="reference internal" href="#biological-insight">Biological Insight</a></li>
</ul>
</li>
<li><a class="reference internal" href="#documentation-for-the-code">Documentation for the code</a><ul>
<li><a class="reference internal" href="#module-pycombat">pyComBat utils</a><ul>
<li><a class="reference internal" href="#pycombat.pycombat"><code class="docutils literal notranslate"><span class="pre">pycombat()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#contributing-to-pycombat">Contributing to pyComBat</a><ul>
<li><a class="reference internal" href="#contribution-guidelines">Contribution guidelines</a></li>
<li><a class="reference internal" href="#unit-testing">Unit Testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authors">Authors</a><ul>
<li><a class="reference internal" href="#contact">Contact</a></li>
<li><a class="reference internal" href="#citing-pycombat">Citing pyComBat</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">pyComBat</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Welcome to pyComBat’s documentation!</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="welcome-to-pycombat-s-documentation">
<h1>Welcome to pyComBat’s documentation!<a class="headerlink" href="#welcome-to-pycombat-s-documentation" title="Permalink to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This package is now deprecated, and no longer maintained in its standalone
version.  It has been merged into <a class="reference external" href="https://github.com/epigenelabs/inmoose">inmoose</a>.  Please consider migrating your
code to <code class="docutils literal notranslate"><span class="pre">inmoose</span></code>.</p>
</div>
<section id="general-overview">
<h2>General Overview<a class="headerlink" href="#general-overview" title="Permalink to this heading"></a></h2>
<p>Variability in datasets are not only the product of biological processes: they are also the product of technical biases (Lander et al, 1999).
ComBat is one of the most widely used tool for correcting those technical biases called batch effects.</p>
<p>pyComBat (Behdenna et al, 2020) is a new Python implementation of ComBat (Johnson et al, 2007), a software widely used for the adjustment of batch effects in microarray data.
While the mathematical framework is strictly the same, pyComBat:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>has similar results in terms of batch effects correction;</p></li>
<li><p>is as fast or faster than the R implementation of ComBat and;</p></li>
<li><p>offers new tools for the community to participate in its development.</p></li>
</ol>
</div></blockquote>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading"></a></h2>
<p>pyComBat is an open source program written in Python language version 3.7.3. It can be run as a command line or a Python library. It is available at <a class="reference external" href="https://github.com/epigenelabs/pyComBat">https://github.com/epigenelabs/pyComBat</a>.</p>
</section>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this heading"></a></h2>
<p>pyComBat is implemented in the Python language and is available under <a class="reference external" href="https://www.gnu.org/licenses/gpl-3.0.en.html">GPL-3.0</a> license.</p>
<p>You can find more detailed information in the LICENSE file.</p>
</section>
<section id="installing-pycombat">
<h2>Installing pyComBat<a class="headerlink" href="#installing-pycombat" title="Permalink to this heading"></a></h2>
<p>pyComBat is usable as a Python package, which is installed with:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">combat</span>
</pre></div>
</div>
<p>To upgrade the package to the latest version, please use:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">combat</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<p>Then, you can import the pycombat function:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">combat.pycombat</span> <span class="kn">import</span> <span class="n">pycombat</span>
</pre></div>
</div>
</section>
</section>
<section id="using-pycombat">
<h1>Using pyComBat<a class="headerlink" href="#using-pycombat" title="Permalink to this heading"></a></h1>
<section id="minimal-usage-example">
<h2>Minimal usage example<a class="headerlink" href="#minimal-usage-example" title="Permalink to this heading"></a></h2>
<p>This minimal usage example illustrates how to use pyComBat in a default setting, and shows some results on ovarian cancer data, freely available on NCBI’s <a class="reference external" href="https://www.ncbi.nlm.nih.gov/geo/">Gene Expression Omnibus</a>, namely:</p>
<blockquote>
<div><ul class="simple">
<li><p>GSE18520</p></li>
<li><p>GSE66957</p></li>
<li><p>GSE69428</p></li>
</ul>
</div></blockquote>
<p>The corresponding expression files are available on <a class="reference external" href="https://github.com/epigenelabs/pyComBat/tree/master/data">GitHub</a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">combat.pycombat</span> <span class="kn">import</span> <span class="n">pycombat</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># prepare data</span>
<span class="c1"># the datasets are dataframes where:</span>
    <span class="c1"># the indexes correspond to the gene names</span>
    <span class="c1"># the column names correspond to the sample names</span>
<span class="c1"># Any number (&gt;=2) of datasets can be treated</span>
<span class="n">dataset_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;data/GSE18520.pickle&quot;</span><span class="p">)</span> <span class="c1"># datasets can also be stored in csv, tsv, etc files</span>
<span class="n">dataset_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;data/GSE66957.pickle&quot;</span><span class="p">)</span>
<span class="n">dataset_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;data/GSE69428.pickle&quot;</span><span class="p">)</span>

<span class="c1"># we merge all the datasets into one, by keeping the common genes only</span>
<span class="n">df_expression</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dataset_1</span><span class="p">,</span><span class="n">dataset_2</span><span class="p">,</span><span class="n">dataset_3</span><span class="p">],</span><span class="n">join</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot raw data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">df_expression</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/distrib_raw.png"><img alt="Distribution of raw data" src="_images/distrib_raw.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Gene expression by sample in the raw data (colored by dataset).</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># we generate the list of batches</span>
<span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset_1</span><span class="p">,</span><span class="n">dataset_2</span><span class="p">,</span><span class="n">dataset_3</span><span class="p">]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">)):</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">))])</span>

<span class="c1"># run pyComBat</span>
<span class="n">df_corrected</span> <span class="o">=</span> <span class="n">pycombat</span><span class="p">(</span><span class="n">df_expression</span><span class="p">,</span><span class="n">batch</span><span class="p">)</span>

<span class="c1"># visualise results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">df_corrected</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="_images/distrib_corrected.png"><img alt="Distribution of corrected data" src="_images/distrib_corrected.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Gene expression by sample in the batch-effects-corrected data (colored by dataset).</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="biological-insight">
<h2>Biological Insight<a class="headerlink" href="#biological-insight" title="Permalink to this heading"></a></h2>
<p>The data we used for the usage example contain tumor samples and normal samples. A simple PCA on the raw expression data shows that, instead of grouping by sample type, the data are clustered by dataset.</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/pca_raw.png"><img alt="PCA for raw data" src="_images/pca_raw.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">PCA on the raw expression data, colored by tumor sample (blue and yellow) and normal sample (pink).</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>However, after correcting for batch effects with pyComBat, the same PCA now shows two clusters, respectively with tumor and normal samples.</p>
<figure class="align-default" id="id4">
<a class="reference internal image-reference" href="_images/pca_corrected.png"><img alt="PCA for data corrected for batch effects" src="_images/pca_corrected.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">PCA on the batch-effects-corrected expression data, colored by tumor sample (blue and yellow) and normal sample (pink).</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="documentation-for-the-code">
<h1>Documentation for the code<a class="headerlink" href="#documentation-for-the-code" title="Permalink to this heading"></a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="module-pycombat">
<span id="pycombat-utils"></span><h2>pyComBat utils<a class="headerlink" href="#module-pycombat" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pycombat.pycombat">
<span class="sig-prename descclassname"><span class="pre">pycombat.</span></span><span class="sig-name descname"><span class="pre">pycombat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">par_prior</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prior_plots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_batch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pycombat.html#pycombat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pycombat.pycombat" title="Permalink to this definition"></a></dt>
<dd><p>Corrects batch effect in microarray expression data. Takes an gene expression file and a list of known batches corresponding to each sample.</p>
<dl>
<dt>Arguments:</dt><dd><p>data {matrix} – The expression matrix (dataframe). It contains the information about the gene expression (rows) for each sample (columns).</p>
<p>batch {list} – List of batch indexes. The batch list describes the batch for each sample. The batches list has as many elements as the number of columns in the expression matrix.</p>
</dd>
<dt>Keyword Arguments:</dt><dd><p>mod {list} – List (or list of lists) of covariate(s) indexes. The mod list describes the covariate(s) for each sample. Each mod list has as many elements as the number of columns in the expression matrix (default: {[]}).</p>
<p>par_prior {bool} – False for non-parametric estimation of batch effects (default: {True}).</p>
<p>prior_plots {bool} – True if requires to plot the priors (default: {False} – Not implemented yet!).</p>
<p>mean_only {bool} – True iff just adjusting the means and not individual batch effects (default: {False}).</p>
<p>ref_batch – reference batch selected (default: {None}).</p>
<p>precision {float} – level of precision for precision computing (default: {None}).</p>
</dd>
<dt>Returns:</dt><dd><p>bayes_data_df – The expression dataframe adjusted for batch effects.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="contributing-to-pycombat">
<h1>Contributing to pyComBat<a class="headerlink" href="#contributing-to-pycombat" title="Permalink to this heading"></a></h1>
<section id="contribution-guidelines">
<h2>Contribution guidelines<a class="headerlink" href="#contribution-guidelines" title="Permalink to this heading"></a></h2>
<p>Contribution guidelines can be found in <a class="reference external" href="https://github.com/epigenelabs/pyComBat/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>
</section>
<section id="unit-testing">
<h2>Unit Testing<a class="headerlink" href="#unit-testing" title="Permalink to this heading"></a></h2>
<p>Most of the subfunctions can be tested separately.
The “unit_test” script implements all of them, and can be used to check the good functioning of the whole pyComBat software.</p>
</section>
</section>
<section id="authors">
<h1>Authors<a class="headerlink" href="#authors" title="Permalink to this heading"></a></h1>
<section id="contact">
<h2>Contact<a class="headerlink" href="#contact" title="Permalink to this heading"></a></h2>
<p>To  ask  a  question  on  pyComBat,  report  a  suggestion  (e.g.   why  not  including  other options) or if you think you have discovered a bug (if any?), please contact:</p>
<p>Abdelkader Behdenna at <a class="reference external" href="mailto:abdelkader&#37;&#52;&#48;epigenelabs&#46;com">abdelkader<span>&#64;</span>epigenelabs<span>&#46;</span>com</a></p>
</section>
<section id="citing-pycombat">
<h2>Citing pyComBat<a class="headerlink" href="#citing-pycombat" title="Permalink to this heading"></a></h2>
<ol class="upperalpha simple">
<li><p>Behdenna, J. Haziza, C.-A. Azencott and A. Nordor. 2020. pyComBat, a Python tool for batch effects correction in high-throughput molecular data using empirical Bayes methods. bioRxiv doi: 10.1101/2020.03.17.995431</p></li>
</ol>
</section>
<section id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Abdelkader Behdenna.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #333333;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #6600CC;
    }
    /* functions */
    /* .rst-content dl:not(.docutils) dt {
      background: #B0F0F7;
      border-top: #10DDBA;
    } */
  </style>


</body>
</html>